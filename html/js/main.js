!function(){for(var t,a=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],i=n.length,e=window.console=window.console||{};i--;)t=n[i],e[t]||(e[t]=a)}(),function(t){"use strict";var a,n,i;t.extend({roundaboutShapes:{def:"lazySusan",lazySusan:function(t,a,n){return{x:Math.sin(t+a),y:Math.sin(t+3*Math.PI/2+a)/8*n,z:(Math.cos(t+a)+1)/2,scale:Math.sin(t+Math.PI/2+a)/2+.5}}}}),a={bearing:0,tilt:0,minZ:100,maxZ:280,minOpacity:.4,maxOpacity:1,minScale:.4,maxScale:1,duration:600,btnNext:null,btnNextCallback:function(){},btnPrev:null,btnPrevCallback:function(){},btnToggleAutoplay:null,btnStartAutoplay:null,btnStopAutoplay:null,easing:"swing",clickToFocus:!0,clickToFocusCallback:function(){},focusBearing:0,shape:"lazySusan",debug:!1,childSelector:"li",startingChild:null,reflect:!1,floatComparisonThreshold:.001,autoplay:!1,autoplayDuration:1e3,autoplayPauseOnHover:!1,autoplayCallback:function(){},autoplayInitialDelay:0,enableDrag:!1,dropDuration:600,dropEasing:"swing",dropAnimateTo:"nearest",dropCallback:function(){},dragAxis:"x",dragFactor:4,triggerFocusEvents:!0,triggerBlurEvents:!0,responsive:!1},n={autoplayInterval:null,autoplayIsRunning:!1,autoplayStartTimeout:null,animating:!1,childInFocus:-1,touchMoveStartPosition:null,stopAnimation:!1,lastAnimationStep:!1},i={init:function(e,o,r){{var u;(new Date).getTime()}return e="object"==typeof e?e:{},o=t.isFunction(o)?o:function(){},o=t.isFunction(e)?e:o,u=t.extend({},a,e,n),this.each(function(){var a=t(this),n=a.children(u.childSelector).length,e=360/n,l=u.startingChild&&u.startingChild>n-1?n-1:u.startingChild,s=null===u.startingChild?u.bearing:360-l*e,c="static"!==a.css("position")?a.css("position"):"relative";a.css({padding:0,position:c}).addClass("roundabout-holder").data("roundabout",t.extend({},u,{startingChild:l,bearing:s,oppositeOfFocusBearing:i.normalize.apply(null,[u.focusBearing-180]),dragBearing:s,period:e})),r?a.unbind(".roundabout").children(u.childSelector).unbind(".roundabout"):u.responsive&&t(window).bind("resize",function(){i.stopAutoplay.apply(a),i.relayoutChildren.apply(a)}),u.clickToFocus&&a.children(u.childSelector).each(function(n){t(this).bind("click.roundabout",function(){var e=i.getPlacement.apply(a,[n]);return i.isInFocus.apply(a,[e])?void 0:(i.stopAnimation.apply(t(this)),a.data("roundabout").animating||i.animateBearingToFocus.apply(a,[e,a.data("roundabout").clickToFocusCallback]),!1)})}),u.btnNext&&t(u.btnNext).bind("click.roundabout",function(){return a.data("roundabout").animating||i.animateToNextChild.apply(a,[a.data("roundabout").btnNextCallback]),!1}),u.btnPrev&&t(u.btnPrev).bind("click.roundabout",function(){return i.animateToPreviousChild.apply(a,[a.data("roundabout").btnPrevCallback]),!1}),u.btnToggleAutoplay&&t(u.btnToggleAutoplay).bind("click.roundabout",function(){return i.toggleAutoplay.apply(a),!1}),u.btnStartAutoplay&&t(u.btnStartAutoplay).bind("click.roundabout",function(){return i.startAutoplay.apply(a),!1}),u.btnStopAutoplay&&t(u.btnStopAutoplay).bind("click.roundabout",function(){return i.stopAutoplay.apply(a),!1}),u.autoplayPauseOnHover&&a.bind("mouseenter.roundabout.autoplay",function(){i.stopAutoplay.apply(a,[!0])}).bind("mouseleave.roundabout.autoplay",function(){i.startAutoplay.apply(a)}),u.enableDrag&&(t.isFunction(a.drag)?t.isFunction(a.drop)?a.drag(function(t,n){var e=a.data("roundabout"),o="x"===e.dragAxis.toLowerCase()?"deltaX":"deltaY";i.stopAnimation.apply(a),i.setBearing.apply(a,[e.dragBearing+n[o]/e.dragFactor])}).drop(function(t){var n=a.data("roundabout"),e=i.getAnimateToMethod(n.dropAnimateTo);i.allowAnimation.apply(a),i[e].apply(a,[n.dropDuration,n.dropEasing,n.dropCallback]),n.dragBearing=n.period*i.getNearestChild.apply(a)}):u.debug&&alert("You do not have the drop plugin loaded."):u.debug&&alert("You do not have the drag plugin loaded."),a.each(function(){var a=t(this).get(0),n=t(this).data("roundabout"),e="x"===n.dragAxis.toLowerCase()?"pageX":"pageY",o=i.getAnimateToMethod(n.dropAnimateTo);a.addEventListener&&(a.addEventListener("touchstart",function(t){n.touchMoveStartPosition=t.touches[0][e]},!1),a.addEventListener("touchmove",function(a){var o=(a.touches[0][e]-n.touchMoveStartPosition)/n.dragFactor;a.preventDefault(),i.stopAnimation.apply(t(this)),i.setBearing.apply(t(this),[n.dragBearing+o])},!1),a.addEventListener("touchend",function(a){a.preventDefault(),i.allowAnimation.apply(t(this)),o=i.getAnimateToMethod(n.dropAnimateTo),i[o].apply(t(this),[n.dropDuration,n.dropEasing,n.dropCallback]),n.dragBearing=n.period*i.getNearestChild.apply(t(this))},!1))})),i.initChildren.apply(a,[o,r])})},initChildren:function(a,n){var e=t(this),o=e.data("roundabout");return a=a||function(){},e.children(o.childSelector).each(function(a){var o,r,u,l=i.getPlacement.apply(e,[a]);n&&t(this).data("roundabout")&&(o=t(this).data("roundabout").startWidth,r=t(this).data("roundabout").startHeight,u=t(this).data("roundabout").startFontSize),t(this).addClass("roundabout-moveable-item").css("position","absolute"),t(this).data("roundabout",{startWidth:o||t(this).width(),startHeight:r||t(this).height(),startFontSize:u||parseInt(t(this).css("font-size"),10),degrees:l,backDegrees:i.normalize.apply(null,[l-180]),childNumber:a,currentScale:1,parent:e})}),i.updateChildren.apply(e),o.autoplay&&(o.autoplayStartTimeout=setTimeout(function(){i.startAutoplay.apply(e)},o.autoplayInitialDelay)),e.trigger("ready"),a.apply(e),e},updateChildren:function(){return this.each(function(){var a=t(this),n=a.data("roundabout"),e=-1,o={bearing:n.bearing,tilt:n.tilt,stage:{width:Math.floor(.9*t(this).width()),height:Math.floor(.9*t(this).height())},animating:n.animating,inFocus:n.childInFocus,focusBearingRadian:i.degToRad.apply(null,[n.focusBearing]),shape:t.roundaboutShapes[n.shape]||t.roundaboutShapes[t.roundaboutShapes.def]};o.midStage={width:o.stage.width/2,height:o.stage.height/2},o.nudge={width:o.midStage.width+.05*o.stage.width,height:o.midStage.height+.05*o.stage.height},o.zValues={min:n.minZ,max:n.maxZ,diff:n.maxZ-n.minZ},o.opacity={min:n.minOpacity,max:n.maxOpacity,diff:n.maxOpacity-n.minOpacity},o.scale={min:n.minScale,max:n.maxScale,diff:n.maxScale-n.minScale},a.children(n.childSelector).each(function(r){!i.updateChild.apply(a,[t(this),o,r,function(){t(this).trigger("ready")}])||o.animating&&!n.lastAnimationStep?t(this).removeClass("roundabout-in-focus"):(e=r,t(this).addClass("roundabout-in-focus"))}),e!==o.inFocus&&(n.triggerBlurEvents&&a.children(n.childSelector).eq(o.inFocus).trigger("blur"),n.childInFocus=e,n.triggerFocusEvents&&-1!==e&&a.children(n.childSelector).eq(e).trigger("focus")),a.trigger("childrenUpdated")})},updateChild:function(a,n,e,o){var r,u=this,l=t(a),s=l.data("roundabout"),c=[],d=i.degToRad.apply(null,[360-s.degrees+n.bearing]);return o=o||function(){},d=i.normalizeRad.apply(null,[d]),r=n.shape(d,n.focusBearingRadian,n.tilt),r.scale=r.scale>1?1:r.scale,r.adjustedScale=(n.scale.min+n.scale.diff*r.scale).toFixed(4),r.width=(r.adjustedScale*s.startWidth).toFixed(4),r.height=(r.adjustedScale*s.startHeight).toFixed(4),l.css({left:(r.x*n.midStage.width+n.nudge.width-r.width/2).toFixed(0)+"px",top:(r.y*n.midStage.height+n.nudge.height-r.height/2).toFixed(0)+"px",width:r.width+"px",height:r.height+"px",opacity:(n.opacity.min+n.opacity.diff*r.scale).toFixed(2),zIndex:Math.round(n.zValues.min+n.zValues.diff*r.z),fontSize:(r.adjustedScale*s.startFontSize).toFixed(1)+"px"}),s.currentScale=r.adjustedScale,u.data("roundabout").debug&&(c.push('<div style="font-weight: normal; font-size: 10px; padding: 2px; width: '+l.css("width")+'; background-color: #ffc;">'),c.push('<strong style="font-size: 12px; white-space: nowrap;">Child '+e+"</strong><br />"),c.push("<strong>left:</strong> "+l.css("left")+"<br />"),c.push("<strong>top:</strong> "+l.css("top")+"<br />"),c.push("<strong>width:</strong> "+l.css("width")+"<br />"),c.push("<strong>opacity:</strong> "+l.css("opacity")+"<br />"),c.push("<strong>height:</strong> "+l.css("height")+"<br />"),c.push("<strong>z-index:</strong> "+l.css("z-index")+"<br />"),c.push("<strong>font-size:</strong> "+l.css("font-size")+"<br />"),c.push("<strong>scale:</strong> "+l.data("roundabout").currentScale),c.push("</div>"),l.html(c.join(""))),l.trigger("reposition"),o.apply(u),i.isInFocus.apply(u,[s.degrees])},setBearing:function(a,n){return n=n||function(){},a=i.normalize.apply(null,[a]),this.each(function(){var n,e=t(this),o=e.data("roundabout"),r=o.bearing;o.bearing=a,e.trigger("bearingSet"),i.updateChildren.apply(e),n=Math.abs(r-a),!o.animating||n>180||(n=Math.abs(r-a),e.children(o.childSelector).each(function(n){var e;i.isChildBackDegreesBetween.apply(t(this),[a,r])&&(e=r>a?"Clockwise":"Counterclockwise",t(this).trigger("move"+e+"ThroughBack"))}))}),n.apply(this),this},adjustBearing:function(a,n){return n=n||function(){},0===a?this:(this.each(function(){i.setBearing.apply(t(this),[t(this).data("roundabout").bearing+a])}),n.apply(this),this)},setTilt:function(a,n){return n=n||function(){},this.each(function(){t(this).data("roundabout").tilt=a,i.updateChildren.apply(t(this))}),n.apply(this),this},adjustTilt:function(a,n){return n=n||function(){},this.each(function(){i.setTilt.apply(t(this),[t(this).data("roundabout").tilt+a])}),n.apply(this),this},animateToBearing:function(a,n,e,o,r){var u=(new Date).getTime();return r=r||function(){},t.isFunction(o)?(r=o,o=null):t.isFunction(e)?(r=e,e=null):t.isFunction(n)&&(r=n,n=null),this.each(function(){var l,s,c,d=t(this),p=d.data("roundabout"),h=n?n:p.duration,f=e?e:p.easing||"swing";return o||(o={timerStart:u,start:p.bearing,totalTime:h}),l=u-o.timerStart,p.stopAnimation?(i.allowAnimation.apply(d),void(p.animating=!1)):void(h>l?(p.animating||d.trigger("animationStart"),p.animating=!0,"string"==typeof t.easing.def?(s=t.easing[f]||t.easing[t.easing.def],c=s(null,l,o.start,a-o.start,o.totalTime)):c=t.easing[f](l/o.totalTime,l,o.start,a-o.start,o.totalTime),i.compareVersions.apply(null,[t().jquery,"1.7.2"])>=0&&!t.easing.easeOutBack&&(c=o.start+(a-o.start)*c),c=i.normalize.apply(null,[c]),p.dragBearing=c,i.setBearing.apply(d,[c,function(){setTimeout(function(){i.animateToBearing.apply(d,[a,h,f,o,r])},0)}])):(p.lastAnimationStep=!0,a=i.normalize.apply(null,[a]),i.setBearing.apply(d,[a,function(){d.trigger("animationEnd")}]),p.animating=!1,p.lastAnimationStep=!1,p.dragBearing=a,r.apply(d)))}),this},animateToNearbyChild:function(a,n){var e=a[0],o=a[1],r=a[2]||function(){};return t.isFunction(o)?(r=o,o=null):t.isFunction(e)&&(r=e,e=null),this.each(function(){var a,u,l=t(this),s=l.data("roundabout"),c=s.reflect?s.bearing:s.bearing%360,d=l.children(s.childSelector).length;if(!s.animating)if(s.reflect&&"previous"===n||!s.reflect&&"next"===n){for(c=Math.abs(c)<s.floatComparisonThreshold?360:c,a=0;d>a;a+=1)if(u={lower:s.period*a,upper:s.period*(a+1)},u.upper=a===d-1?360:u.upper,c<=Math.ceil(u.upper)&&c>=Math.floor(u.lower)){2===d&&360===c?i.animateToDelta.apply(l,[-180,e,o,r]):i.animateBearingToFocus.apply(l,[u.lower,e,o,r]);break}}else for(c=Math.abs(c)<s.floatComparisonThreshold||360-Math.abs(c)<s.floatComparisonThreshold?0:c,a=d-1;a>=0;a-=1)if(u={lower:s.period*a,upper:s.period*(a+1)},u.upper=a===d-1?360:u.upper,c>=Math.floor(u.lower)&&c<Math.ceil(u.upper)){2===d&&360===c?i.animateToDelta.apply(l,[180,e,o,r]):i.animateBearingToFocus.apply(l,[u.upper,e,o,r]);break}})},animateToNearestChild:function(a,n,e){return e=e||function(){},t.isFunction(n)?(e=n,n=null):t.isFunction(a)&&(e=a,a=null),this.each(function(){var o=i.getNearestChild.apply(t(this));i.animateToChild.apply(t(this),[o,a,n,e])})},animateToChild:function(a,n,e,o){return o=o||function(){},t.isFunction(e)?(o=e,e=null):t.isFunction(n)&&(o=n,n=null),this.each(function(){var r,u=t(this),l=u.data("roundabout");l.childInFocus===a||l.animating||(r=u.children(l.childSelector).eq(a),i.animateBearingToFocus.apply(u,[r.data("roundabout").degrees,n,e,o]))})},animateToNextChild:function(t,a,n){return i.animateToNearbyChild.apply(this,[arguments,"next"])},animateToPreviousChild:function(t,a,n){return i.animateToNearbyChild.apply(this,[arguments,"previous"])},animateToDelta:function(a,n,e,o){return o=o||function(){},t.isFunction(e)?(o=e,e=null):t.isFunction(n)&&(o=n,n=null),this.each(function(){var r=t(this).data("roundabout").bearing+a;i.animateToBearing.apply(t(this),[r,n,e,o])})},animateBearingToFocus:function(a,n,e,o){return o=o||function(){},t.isFunction(e)?(o=e,e=null):t.isFunction(n)&&(o=n,n=null),this.each(function(){var r=t(this).data("roundabout").bearing-a;r=Math.abs(360-r)<Math.abs(r)?360-r:-r,r=r>180?-(360-r):r,0!==r&&i.animateToDelta.apply(t(this),[r,n,e,o])})},stopAnimation:function(){return this.each(function(){t(this).data("roundabout").stopAnimation=!0})},allowAnimation:function(){return this.each(function(){t(this).data("roundabout").stopAnimation=!1})},startAutoplay:function(a){return this.each(function(){var n=t(this),e=n.data("roundabout");a=a||e.autoplayCallback||function(){},clearInterval(e.autoplayInterval),e.autoplayInterval=setInterval(function(){i.animateToNextChild.apply(n,[a])},e.autoplayDuration),e.autoplayIsRunning=!0,n.trigger("autoplayStart")})},stopAutoplay:function(a){return this.each(function(){clearInterval(t(this).data("roundabout").autoplayInterval),t(this).data("roundabout").autoplayInterval=null,t(this).data("roundabout").autoplayIsRunning=!1,a||t(this).unbind(".autoplay"),t(this).trigger("autoplayStop")})},toggleAutoplay:function(a){return this.each(function(){var n=t(this),e=n.data("roundabout");a=a||e.autoplayCallback||function(){},i.isAutoplaying.apply(t(this))?i.stopAutoplay.apply(t(this),[a]):i.startAutoplay.apply(t(this),[a])})},isAutoplaying:function(){return this.data("roundabout").autoplayIsRunning},changeAutoplayDuration:function(a){return this.each(function(){var n=t(this),e=n.data("roundabout");e.autoplayDuration=a,i.isAutoplaying.apply(n)&&(i.stopAutoplay.apply(n),setTimeout(function(){i.startAutoplay.apply(n)},10))})},normalize:function(t){var a=t%360;return 0>a?360+a:a},normalizeRad:function(t){for(;0>t;)t+=2*Math.PI;for(;t>2*Math.PI;)t-=2*Math.PI;return t},isChildBackDegreesBetween:function(a,n){var i=t(this).data("roundabout").backDegrees;return a>n?i>=n&&a>i:n>i&&i>=a},getAnimateToMethod:function(t){return t=t.toLowerCase(),"next"===t?"animateToNextChild":"previous"===t?"animateToPreviousChild":"animateToNearestChild"},relayoutChildren:function(){return this.each(function(){var a=t(this),n=t.extend({},a.data("roundabout"));n.startingChild=a.data("roundabout").childInFocus,i.init.apply(a,[n,null,!0])})},getNearestChild:function(){var a=t(this),n=a.data("roundabout"),i=a.children(n.childSelector).length;return n.reflect?Math.round(n.bearing/n.period)%i:(i-Math.round(n.bearing/n.period)%i)%i},degToRad:function(t){return i.normalize.apply(null,[t])*Math.PI/180},getPlacement:function(t){var a=this.data("roundabout");return a.reflect?a.period*t:360-a.period*t},isInFocus:function(t){var a,n=this,e=n.data("roundabout"),o=i.normalize.apply(null,[e.bearing]);return t=i.normalize.apply(null,[t]),a=Math.abs(o-t),a<=e.floatComparisonThreshold||a>=360-e.floatComparisonThreshold},getChildInFocus:function(){var a=t(this).data("roundabout");return a.childInFocus>-1?a.childInFocus:!1},compareVersions:function(t,a){var n,i=t.split(/\./i),e=a.split(/\./i),o=i.length>e.length?i.length:e.length;for(n=0;o>=n;n++){if(i[n]&&!e[n]&&0!==parseInt(i[n],10))return 1;if(e[n]&&!i[n]&&0!==parseInt(e[n],10))return-1;if(i[n]!==e[n]&&i[n]&&e[n])return parseInt(i[n],10)>parseInt(e[n],10)?1:-1}return 0}},t.fn.roundabout=function(a){return i[a]?i[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"==typeof a||t.isFunction(a)||!a?i.init.apply(this,arguments):void t.error("Method "+a+" does not exist for jQuery.roundabout.")}}(jQuery),$(function(){$("#header").add("#cap_b").add("#work_b").parallax({lift:"ratio",ratio:.5}),$("#plane_b").parallax(),$("#works_b").roundabout({duration:200,minOpacity:1,btnNext:".slider_label"}),$(document).on("scroll",function(){$(this).scrollTop()>=$("#header").height()?$("#f_contact .contact_l").addClass("fix-contact"):$("#f_contact .contact_l").removeClass("fix-contact")}),$(".about_b").foShowed(function(){this.find(".item").afterTime(function(){$(this).addClass("animate")},300)}),$(".cap_b").foShowed(function(){$(".c_box",this).add(".form",this).afterTime(function(){$(this).addClass("animate")},500)}),$(".features_b").foShowed(function(){this.find(".item").afterTime(function(){$(this).addClass("animate")},300)}),$(".partners_b").foShowed(function(){this.find(".item img").afterTime(function(){$(this).addClass("animate")},300)}),$("#work_b").foShowed(function(){this.find("#works_b").add(".slider_label",this).afterTime(function(){$(this).addClass("animate")},300)},{full:!1,offset:-300});var t=new Date,a=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"];$(".c-date").text(t.getDate()+" "+a[t.getMonth()]),$(".target").on("click",function(){var t=$(this).data("target"),a=$("#"+t).offset().top-20;0>a&&(a=0),$("body,html").animate({scrollTop:a},700)}),$("input").on("click",function(){$(this).removeClass("error")})});var showMap=function(){window.ymaps&&$(".map").each(function(){var t=$(this).data("center");t=t.split(",");var a=new ymaps.Map($(this).attr("id"),{center:[t[0],t[1]],zoom:$(this).data("zoom"),type:"yandex#publicMap"});$this=this;var n=$(this).data("pointer");n=n.split(",");var i=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[n[0],n[1]]},properties:{iconContent:$(this).data("title")}},{preset:"islands#blueStretchyIcon"});a.geoObjects.add(i),a.behaviors.disable(["scrollZoom"])})};!function(t){Array();t.fn.parallax=function(a){t.extend({lift:"auto",ratio:1,gorizontal:"50%",offset:0,shift:0},a)},t.fn.afterTime=function(t,a,n){if("function"!=typeof t)return this;a||(a=300);var i=0;return this.each(function(){var e=this;setTimeout(function(){t.apply(e,n)},i),i+=a}),this},t.fn.foShowed=function(a,n){if("function"!=typeof a)return this;var i="foShowed"+Math.random(),e=this,o=t.extend({full:!0,offset:0},n);t(document).on("scroll."+i,function(){o.full?e.position().top+o.offset<t(window).scrollTop()+t("body").height()&&e.position().top+e.outerHeight()<t(window).scrollTop()+t("body").height()&&(a.apply(e,o),t(document).off("scroll."+i)):e.position().top<t(window).scrollTop()+o.offset+t("body").height()&&e.position().top+e.outerHeight()>t(window).scrollTop()&&(a.apply(e,o),t(document).off("scroll."+i))})}}(jQuery),function(t){function a(){var t=document.createElement("input"),a="onpaste";return t.setAttribute(a,""),"function"==typeof t[a]?"paste":"input"}var n,i=a()+".mask",e=navigator.userAgent,o=/iphone/i.test(e),r=/android/i.test(e);t.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},t.fn.extend({caret:function(t,a){var n;return 0===this.length||this.is(":hidden")?void 0:"number"==typeof t?(a="number"==typeof a?a:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,a):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",a),n.moveStart("character",t),n.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,a=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),t=0-n.duplicate().moveStart("character",-1e5),a=t+n.text.length),{begin:t,end:a})},unmask:function(){return this.trigger("unmask")},mask:function(a,e){var u,l,s,c,d,p;return!a&&this.length>0?(u=t(this[0]),u.data(t.mask.dataName)()):(e=t.extend({placeholder:t.mask.placeholder,completed:null},e),l=t.mask.definitions,s=[],c=p=a.length,d=null,t.each(a.split(""),function(t,a){"?"==a?(p--,c=t):l[a]?(s.push(RegExp(l[a])),null===d&&(d=s.length-1)):s.push(null)}),this.trigger("unmask").each(function(){function u(t){for(;p>++t&&!s[t];);return t}function h(t){for(;--t>=0&&!s[t];);return t}function f(t,a){var n,i;if(!(0>t)){for(n=t,i=u(a);p>n;n++)if(s[n]){if(!(p>i&&s[n].test(w[i])))break;w[n]=w[i],w[i]=e.placeholder,i=u(i)}v(),S.caret(Math.max(d,t))}}function g(t){var a,n,i,o;for(a=t,n=e.placeholder;p>a;a++)if(s[a]){if(i=u(a),o=w[a],w[a]=n,!(p>i&&s[i].test(o)))break;n=o}}function m(t){var a,n,i,e=t.which;8===e||46===e||o&&127===e?(a=S.caret(),n=a.begin,i=a.end,0===i-n&&(n=46!==e?h(n):i=u(n-1),i=46===e?u(i):i),y(n,i),f(n,i-1),t.preventDefault()):27==e&&(S.val(C),S.caret(0,T()),t.preventDefault())}function b(a){var n,i,o,l=a.which,c=S.caret();a.ctrlKey||a.altKey||a.metaKey||32>l||l&&(0!==c.end-c.begin&&(y(c.begin,c.end),f(c.begin,c.end-1)),n=u(c.begin-1),p>n&&(i=String.fromCharCode(l),s[n].test(i)&&(g(n),w[n]=i,v(),o=u(n),r?setTimeout(t.proxy(t.fn.caret,S,o),0):S.caret(o),e.completed&&o>=p&&e.completed.call(S))),a.preventDefault())}function y(t,a){var n;for(n=t;a>n&&p>n;n++)s[n]&&(w[n]=e.placeholder)}function v(){S.val(w.join(""))}function T(t){var a,n,i=S.val(),o=-1;for(a=0,pos=0;p>a;a++)if(s[a]){for(w[a]=e.placeholder;pos++<i.length;)if(n=i.charAt(pos-1),s[a].test(n)){w[a]=n,o=a;break}if(pos>i.length)break}else w[a]===i.charAt(pos)&&a!==c&&(pos++,o=a);return t?v():c>o+1?(S.val(""),y(0,p)):(v(),S.val(S.val().substring(0,o+1))),c?a:d}var S=t(this),w=t.map(a.split(""),function(t){return"?"!=t?l[t]?e.placeholder:t:void 0}),C=S.val();S.data(t.mask.dataName,function(){return t.map(w,function(t,a){return s[a]&&t!=e.placeholder?t:null}).join("")}),S.attr("readonly")||S.one("unmask",function(){S.unbind(".mask").removeData(t.mask.dataName)}).bind("focus.mask",function(){clearTimeout(n);var t;C=S.val(),t=T(),n=setTimeout(function(){v(),t==a.length?S.caret(0,t):S.caret(t)},10)}).bind("blur.mask",function(){T(),S.val()!=C&&S.change()}).bind("keydown.mask",m).bind("keypress.mask",b).bind(i,function(){setTimeout(function(){var t=T(!0);S.caret(t),e.completed&&t==S.val().length&&e.completed.call(S)},0)}),T()}))}})}(jQuery);